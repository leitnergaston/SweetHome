/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package vista.inmueble;

import accesoADatos.*;
import entidades.*;
import java.util.ArrayList;
import javax.swing.JOptionPane;
import vista.menuPrincipal.MenuPrincipal;

/**
 *
 * @author ale77
 */
public class CargaDeInmueble extends javax.swing.JInternalFrame {
private MenuPrincipal menuPrincipal;
private InmuebleData inmuebleData = new InmuebleData();
private PropietarioData propietarioData = new PropietarioData();
private int aviso = 0;
    
    public CargaDeInmueble(MenuPrincipal menuPrincipal) {
        initComponents();
        this.menuPrincipal = menuPrincipal;
        cargarComboPropietario();
        cargarComboTipo();
        cargarComboZona();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        checkDisponible = new javax.swing.JCheckBox();
        botonBuscar = new javax.swing.JButton();
        botonEliminar = new javax.swing.JButton();
        botonSalir = new javax.swing.JButton();
        botonGuardar = new javax.swing.JButton();
        botonModificar = new javax.swing.JButton();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        campoDireccion = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        campoSuperficie = new javax.swing.JTextField();
        jLabel5 = new javax.swing.JLabel();
        campoPrecio = new javax.swing.JTextField();
        jLabel6 = new javax.swing.JLabel();
        campoId = new javax.swing.JTextField();
        jLabel7 = new javax.swing.JLabel();
        jLabel8 = new javax.swing.JLabel();
        comboPropietario = new javax.swing.JComboBox<>();
        comboTipo = new javax.swing.JComboBox<>();
        jLabel9 = new javax.swing.JLabel();
        comboZona = new javax.swing.JComboBox<>();
        jButton1 = new javax.swing.JButton();

        checkDisponible.setText("Disponible");

        botonBuscar.setText("Buscar");
        botonBuscar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonBuscarActionPerformed(evt);
            }
        });

        botonEliminar.setText("Eliminar");
        botonEliminar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonEliminarActionPerformed(evt);
            }
        });

        botonSalir.setFont(new java.awt.Font("Segoe UI", 0, 10)); // NOI18N
        botonSalir.setText("Salir");
        botonSalir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonSalirActionPerformed(evt);
            }
        });

        botonGuardar.setText("Guardar");
        botonGuardar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonGuardarActionPerformed(evt);
            }
        });

        botonModificar.setText("Modificar");
        botonModificar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonModificarActionPerformed(evt);
            }
        });

        jLabel1.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel1.setText("Carga de Datos");

        jLabel2.setFont(new java.awt.Font("Segoe UI", 1, 18)); // NOI18N
        jLabel2.setForeground(new java.awt.Color(0, 153, 153));
        jLabel2.setText("Inmueble");

        jLabel3.setText("Propietario");

        jLabel4.setText("Dirección");

        campoSuperficie.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                campoSuperficieKeyTyped(evt);
            }
        });

        jLabel5.setText("Tipo");

        campoPrecio.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                campoPrecioKeyTyped(evt);
            }
        });

        jLabel6.setText("Superficie");

        campoId.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                campoIdKeyTyped(evt);
            }
        });

        jLabel7.setText("Precio");

        jLabel8.setText("Id");

        jLabel9.setText("Zona");

        jButton1.setText("Nuevo");
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(58, 58, 58)
                .addComponent(jButton1)
                .addGap(18, 18, 18)
                .addComponent(botonGuardar)
                .addGap(18, 18, 18)
                .addComponent(botonEliminar)
                .addGap(18, 18, 18)
                .addComponent(botonModificar)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addComponent(botonSalir, javax.swing.GroupLayout.PREFERRED_SIZE, 51, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addGap(58, 58, 58)
                                .addComponent(jLabel8))
                            .addGroup(layout.createSequentialGroup()
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                                        .addContainerGap()
                                        .addComponent(jLabel2))
                                    .addGroup(layout.createSequentialGroup()
                                        .addGap(58, 58, 58)
                                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                            .addComponent(jLabel3)
                                            .addComponent(jLabel4)
                                            .addComponent(jLabel5)
                                            .addComponent(jLabel6)
                                            .addComponent(jLabel7)
                                            .addComponent(jLabel9))))
                                .addGap(55, 55, 55)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(campoSuperficie)
                                    .addComponent(campoPrecio)
                                    .addComponent(comboTipo, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                    .addComponent(comboZona, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                    .addComponent(comboPropietario, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                    .addComponent(campoDireccion)
                                    .addGroup(layout.createSequentialGroup()
                                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                            .addComponent(jLabel1)
                                            .addComponent(checkDisponible)
                                            .addComponent(campoId, javax.swing.GroupLayout.PREFERRED_SIZE, 200, javax.swing.GroupLayout.PREFERRED_SIZE))
                                        .addGap(0, 0, Short.MAX_VALUE)))))
                        .addGap(36, 36, 36)
                        .addComponent(botonBuscar)))
                .addGap(37, 37, 37))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(jLabel1))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(16, 16, 16)
                        .addComponent(jLabel2)))
                .addGap(35, 35, 35)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel8)
                    .addComponent(campoId, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(botonBuscar))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel3)
                    .addComponent(comboPropietario, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel4)
                    .addComponent(campoDireccion, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel5)
                    .addComponent(comboTipo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel6)
                    .addComponent(campoSuperficie, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel7)
                    .addComponent(campoPrecio, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel9)
                    .addComponent(comboZona, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 16, Short.MAX_VALUE)
                .addComponent(checkDisponible)
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(botonModificar)
                    .addComponent(botonGuardar)
                    .addComponent(botonEliminar)
                    .addComponent(jButton1))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(botonSalir)
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void botonSalirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_botonSalirActionPerformed
        dispose();
        menuPrincipal.mostrarItemsEscritorio();
    }//GEN-LAST:event_botonSalirActionPerformed

    private void botonBuscarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_botonBuscarActionPerformed
        try{
            
            int id = Integer.parseInt(campoId.getText());
            Inmueble inmueble = inmuebleData.buscarInmueble(id);
            if(inmueble==null){
                JOptionPane.showMessageDialog(this, "No existe ningún inmueble con esa Id");
                vaciarCampos();
            }else{
                JOptionPane.showMessageDialog(null,"Inmueble encontrado");
                int cantidadPropietarios = comboPropietario.getItemCount();
                for(int i=1; i<cantidadPropietarios; i++){
                    Propietario proCombo = comboPropietario.getItemAt(i);
                    if(proCombo.getIdPropietario()==inmueble.getPropietario().getIdPropietario()){
                        comboPropietario.setSelectedIndex(i);
                    }
                }
                campoDireccion.setText(inmueble.getDireccion());
                int cantidadTipos = comboTipo.getItemCount();
                for(int i=1; i<cantidadTipos; i++){
                    
                    if(inmueble.getTipo().equalsIgnoreCase(comboTipo.getItemAt(i))){
                        comboTipo.setSelectedIndex(i);
                    }
                }
                campoSuperficie.setText(inmueble.getSuperficie()+"");
                campoPrecio.setText(inmueble.getPrecio()+"");
                int cantidadZonas = comboZona.getItemCount();
                for(int i=1; i<cantidadZonas; i++){
                    if(inmueble.getZona().equalsIgnoreCase(comboZona.getItemAt(i))){
                        comboZona.setSelectedIndex(i);
                    }
                }
                if(inmueble.isDisponible()){
                    checkDisponible.setSelected(true);
                }else{
                    checkDisponible.setSelected(false);
                }
                
            }
        }catch(NumberFormatException ex){
            if(campoId.getText().isEmpty()){
                JOptionPane.showMessageDialog(this, "Para buscar debe llenar el campo de Id");  
            }
        }    
    }//GEN-LAST:event_botonBuscarActionPerformed

    private void campoIdKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_campoIdKeyTyped
        
        int key = evt.getKeyChar();
        boolean numero = key >= 48 && key <= 57 || key == 8;
        if (!numero) {
            evt.consume();
            aviso++;
            if (aviso == 5) {
                JOptionPane.showMessageDialog(this, "Solo se permiten numeros en este campo");
                aviso = 0;
            }
        }
        
    }//GEN-LAST:event_campoIdKeyTyped

    private void campoPrecioKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_campoPrecioKeyTyped
        
        int key = evt.getKeyChar();
        boolean numero;
        if(campoPrecio.getText().contains(".")){
            numero = key >= 48 && key <= 57 || key == 8; 
        }
        else{
            numero = key >= 48 && key <= 57 || key == 46 || key == 8;
        }
        if (!numero) {
            evt.consume();
            aviso++;
            if (aviso == 5) {
                JOptionPane.showMessageDialog(this, "En este campo solo puede ingresar números enteros o números decimales");
                aviso = 0;
            }
        }
    }//GEN-LAST:event_campoPrecioKeyTyped

    private void campoSuperficieKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_campoSuperficieKeyTyped
        
        int key = evt.getKeyChar();
        boolean numero;
        if(campoSuperficie.getText().contains(".")){
            numero = key >= 48 && key <= 57 || key == 8; 
        }
        else{
            numero = key >= 48 && key <= 57 || key == 46 || key == 8;
        }
        if (!numero) {
            evt.consume();
            aviso++;
            if (aviso == 5) {
                JOptionPane.showMessageDialog(this, "En este campo solo puede ingresar números enteros o números decimales");
                aviso = 0;
            }
        }
    }//GEN-LAST:event_campoSuperficieKeyTyped

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        vaciarCampos();
    }//GEN-LAST:event_jButton1ActionPerformed

    private void botonGuardarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_botonGuardarActionPerformed
        try{
              
            if(comboPropietario.getSelectedIndex()<1 || comboTipo.getSelectedIndex()<1 || comboZona.getSelectedIndex()<1){
                JOptionPane.showMessageDialog(this, "No deje los campos de propietario, tipo o zona vacios.");
            }else if(campoDireccion.getText().isEmpty() || campoSuperficie.getText().isEmpty() || campoPrecio.getText().isEmpty()){
                JOptionPane.showMessageDialog(this, "No deje los campos de direccion, superficie o precio vacíos.");
            }else{
                
                Propietario propietario = (Propietario)comboPropietario.getSelectedItem();
                String direccion = campoDireccion.getText();
                String tipo = (String)comboTipo.getSelectedItem();
                double superficie = Double.parseDouble(campoSuperficie.getText());
                double precio = Double.parseDouble(campoPrecio.getText());
                String zona = (String)comboZona.getSelectedItem();
                boolean disponible = false;
                if(checkDisponible.isSelected()){
                    disponible = true;
                }
                
                Inmueble inmueble = new Inmueble(propietario, direccion, tipo, superficie, precio, zona, disponible);
                
                inmuebleData.crearInmueble(inmueble);
                
                campoId.setText(inmueble.getIdInmueble()+"");
            }
            
        }catch(NumberFormatException ex){
            JOptionPane.showMessageDialog(this, "Para poder guardar un inmueble debe llenar todos los campos menos el de Id");
        }
    }//GEN-LAST:event_botonGuardarActionPerformed

    private void botonEliminarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_botonEliminarActionPerformed
        if(campoId.getText().isEmpty()){
            JOptionPane.showMessageDialog(this, "Para eliminar debe seleccionar la Id correspondiente");
        }else{
            int id = Integer.parseInt(campoId.getText());
            inmuebleData.eliminarInmueble(id);
            checkDisponible.setSelected(false);
        }
    }//GEN-LAST:event_botonEliminarActionPerformed

    private void botonModificarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_botonModificarActionPerformed
        try{
            if(campoId.getText().isEmpty()){
                JOptionPane.showMessageDialog(this, "Para modificar un inmueble primero tiene que buscar un inmueble por el Id"); 
            }else if(comboPropietario.getSelectedIndex()<1 || comboTipo.getSelectedIndex()<1 || comboZona.getSelectedIndex()<1){
                JOptionPane.showMessageDialog(this, "No deje los campos de propietario, tipo o zona vacios.");
            }else if(campoDireccion.getText().isEmpty() || campoSuperficie.getText().isEmpty() || campoPrecio.getText().isEmpty()){
                JOptionPane.showMessageDialog(this, "No deje los campos de id, direccion, superficie o precio vacíos.");
            }else{
                
                int id = Integer.parseInt(campoId.getText());
                Propietario propietario = (Propietario)comboPropietario.getSelectedItem();              
                String direccion = campoDireccion.getText();
                String tipo = (String)comboTipo.getSelectedItem();
                double superficie = Double.parseDouble(campoSuperficie.getText());
                double precio = Double.parseDouble(campoPrecio.getText());
                String zona = (String)comboZona.getSelectedItem();
                boolean disponible = false;
                if(checkDisponible.isSelected()){
                    disponible = true;
                }
                
                Inmueble inmueble = new Inmueble(id, propietario, direccion, tipo, superficie, precio, zona, disponible);
                
                inmuebleData.modificarInmueble(inmueble);
                   
            }
            
        }catch(NumberFormatException ex){
            JOptionPane.showMessageDialog(this, "Para poder modificar un inmueble debe llenar todos los campos");
        }
    }//GEN-LAST:event_botonModificarActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton botonBuscar;
    private javax.swing.JButton botonEliminar;
    private javax.swing.JButton botonGuardar;
    private javax.swing.JButton botonModificar;
    private javax.swing.JButton botonSalir;
    private javax.swing.JTextField campoDireccion;
    private javax.swing.JTextField campoId;
    private javax.swing.JTextField campoPrecio;
    private javax.swing.JTextField campoSuperficie;
    private javax.swing.JCheckBox checkDisponible;
    private javax.swing.JComboBox<Propietario> comboPropietario;
    private javax.swing.JComboBox<String> comboTipo;
    private javax.swing.JComboBox<String> comboZona;
    private javax.swing.JButton jButton1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    // End of variables declaration//GEN-END:variables

    private void cargarComboPropietario(){
        
        ArrayList<Propietario> propietarios = propietarioData.listarPropietarios();
        
        comboPropietario.addItem(null);
        for(Propietario propietario: propietarios){
            comboPropietario.addItem(propietario);
            
        }    
    }
    
    private void cargarComboTipo(){
        
        comboTipo.addItem(null);
        comboTipo.addItem("Local");
        comboTipo.addItem("Depósito");
        comboTipo.addItem("Oficina");
        comboTipo.addItem("Casa");
        comboTipo.addItem("Departamento");
    }
    
    private void cargarComboZona(){
        comboZona.addItem(null);
        comboZona.addItem("Centro");
        comboZona.addItem("Norte");
        comboZona.addItem("Oeste");
        comboZona.addItem("Este");
        comboZona.addItem("Sur");
    }

    private void vaciarCampos(){
        campoId.setText("");
        comboPropietario.setSelectedIndex(0);
        campoDireccion.setText("");
        comboTipo.setSelectedIndex(0);
        campoSuperficie.setText("");
        campoPrecio.setText("");
        comboZona.setSelectedIndex(0);
        checkDisponible.setSelected(false);
    }
}
